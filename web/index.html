<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="disknova_project">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>disknova_project</title>
  <link rel="manifest" href="manifest.json">
</head>

<body>
<script>
  // Expose a global function that returns a Promise<Blob>
  window.generateVideoThumbnail = function (file) {
    return new Promise((resolve, reject) => {
      try {
        const video = document.createElement('video');
        const url = URL.createObjectURL(file);
        video.src = url;
        video.crossOrigin = 'anonymous';
        video.muted = true;
        video.playsInline = true;

        // Wait for metadata, then seek to ~10% of the video (or 1 s)
        video.onloadedmetadata = () => {
          const seek = Math.min(1, video.duration * 0.1);
          video.currentTime = seek;
        };

        video.onseeked = () => {
          const canvas = document.createElement('canvas');
          canvas.width  = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

          canvas.toBlob(blob => {
            URL.revokeObjectURL(url);   // clean up
            if (blob) resolve(blob);
            else reject('toBlob returned null');
          }, 'image/jpeg', 0.8);
        };

        video.onerror = (e) => {
          URL.revokeObjectURL(url);
          reject('Video error: ' + (e.message || 'unknown'));
        };
      } catch (err) {
        reject('JS error: ' + err);
      }
    });
  };
</script>
<script src="flutter_bootstrap.js" async></script>

</body>
</html>
